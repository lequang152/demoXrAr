<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo</title>
  </head>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>
  <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
  <style>
    /* Style for the modal */
    .modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 20px;
    background-color: #ffffff;
    border: 1px solid #dcdcdc;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    z-index: 9999;
    max-width: 400px;
    width: 100%;
    text-align: center;
    border-radius: 8px;
    }

    /* Style for the modal overlay */
    .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9998;
    }

    /* Style for the modal content */
    #modal-content {
    font-size: 16px;
    color: #333333;
    margin-bottom: 15px;
    }

    /* Style for the close button */
    button {
    background-color: #007bff;
    color: #ffffff;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    }

    button:hover {
    background-color: #0056b3;
    }
  </style>
  <body>
    <script>
       const products = [
            { name: 'Nồi', quantity: 2 },
            { name: 'Nước rửa bát', quantity: 3 },
            { name: 'Nước lau nhà', quantity: 4 },
            { name: 'Quần', quantity: 1 }
        ];

    function getRandomProduct() {
      const randomIndex = Math.floor(Math.random() * products.length);
      return products[randomIndex];
    }

      AFRAME.registerComponent('locationfinder', {
        init: function() {
          navigator.geolocation.getCurrentPosition(function(location) {
            console.log(location)
          })
        }
      })

      AFRAME.registerComponent('foo', {
      events: {
        click: function (evt) {
          console.log('This entity was clicked!');
        }
      }
    });
    AFRAME.registerComponent('markerhandler', {
      init: function () {
        this.el.sceneEl.addEventListener('markerFound', () => {
          // redirect to custom URL
          console.log('found')
        });
        
        this.el.addEventListener('click', () => {
        const selectedProduct = getRandomProduct();

        // Display the selected product
        console.log('Selected Product:', selectedProduct);

        // Check if there is enough quantity
        if (selectedProduct.quantity > 0) {
          // Decrease the quantity by 1
          selectedProduct.quantity--;
          console.log('Quantity Decreased. New Quantity:', selectedProduct.quantity);
          // Show the appropriate modal message
          showResultModal(selectedProduct);
        } else {
          console.log('Out of Stock!');
          showResultModal(null);
        }
      });
    }})
          // Function to show the result modal
    function showResultModal(selectedProduct) {
        const modal = document.getElementById('modal');
        const overlay = document.getElementById('overlay');
        const modalContent = document.getElementById('modal-content');

        if (selectedProduct) {
        modalContent.innerHTML = `Chúc mừng bạn đã trúng vật phẩm: ${selectedProduct.name}!`;
        } else {
        modalContent.innerHTML = 'Chúc bạn may mắn lần sau!';
        }
        modal.style.display = 'block';
        overlay.style.display = 'block';
    }

    function closeModal() {
        const modal = document.getElementById('modal');
        const overlay = document.getElementById('overlay');

        modal.style.display = 'none';
        overlay.style.display = 'none';
    }
    </script>
  
    <!-- <div id="root"> -->
      <a-scene cursor="rayOrigin: mouse" vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false' renderer='antialias: true; alpha: true'>
        <a-assets>
          <a-asset-item id="animated-asset" src="/assets/model/dog.gltf">
            <img id="image-src" src="/assets/hiro.png" >
          </a-asset-item>
        </a-assets>
        <a-camera locationfinder gps-new-camera='simulateLatitude: 21.0436096; simulateLongitude: 105.84064'></a-camera>
        <a-entity 
          gltf-model="#animated-asset" 
          look-at="[gps-new-camera]" 
          align="center" 
          gps-new-entity-place="latitude: 21.0456096; longitude: 105.84068" 
          scale="15 15 15" 
          animation__rotation="property: rotation; to: 0 360 0; loop: true; dur: 5000"
          markerhandler
          >
        </a-entity>
    </a-scene>
    <div id="modal" class="modal">
      <div id="modal-content">
        <!-- Modal content will be inserted here dynamically -->
      </div>
      <button onclick="closeModal()">Close</button>
    </div>
    <div id="overlay" class="overlay" onclick="closeModal()"></div>
    <!-- </div> -->

    <script type="module" src="/src/main.tsx"></script>
 
  </body>
</html>